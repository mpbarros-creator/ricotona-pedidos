<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <base href="https://mpbarros-creator.github.io/ricotona-pedidos/">
  <title>Nota de Pedido — Ricotona</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial,Helvetica,sans-serif;background:#121212;color:#f5f5f5;padding:12px}
    header{text-align:center;margin-bottom:12px}
    header img{max-width:160px;height:auto}
    header h1{font-size:28px;margin-top:8px;color:#ff9800}

    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    .card{background:#1a1a1a;border:1px solid #333;border-radius:8px;padding:12px}
    .card h2{font-size:18px;color:#ff9800;margin-bottom:10px}

    label{display:block;font-size:14px;margin-bottom:6px;color:#ddd}
    input,textarea{width:100%;padding:8px;font-size:14px;margin-bottom:10px;border:1px solid #444;border-radius:4px;background:#1e1e1e;color:#f5f5f5}
    textarea{min-height:80px;resize:vertical}

    /* date look */
    input[type="date"]{
      color-scheme:dark;background:#1e1e1e;color:#f5f5f5;border:1px solid #444;
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 24 24' fill='none'><rect x='3' y='4' width='18' height='18' rx='2' ry='2' stroke='%23ff9800' stroke-width='2'/><line x1='16' y1='2' x2='16' y2='6' stroke='%23ff9800' stroke-width='2'/><line x1='8' y1='2' x2='8' y2='6' stroke='%23ff9800' stroke-width='2'/><line x1='3' y1='10' x2='21' y2='10' stroke='%23ff9800' stroke-width='2'/></svg>");
      background-repeat:no-repeat;background-position:right 10px center;background-size:22px 22px;padding-right:40px
    }

    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    button{border:none;border-radius:6px;padding:10px 14px;font-weight:bold;cursor:pointer;color:#fff}
    .btn-primary{background:#0a6cff}
    .btn-warning{background:#ff9800;color:#111}
    .btn-danger{background:#dc3545}

    /* por si script.js genera tablas de productos */
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border:1px solid #333;padding:6px;text-align:center}
    thead{background:#2a2a2a;color:#ff9800}
    tbody tr:nth-child(even){background:#181818}

    footer{margin-top:14px;text-align:center;color:#aaa;font-size:12px}
    footer button{background:none;border:none;color:#0a6cff;text-decoration:underline;padding:6px;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo Ricotona">
    <h1>Nota de Pedido</h1>
  </header>

  <div class="grid">
    <!-- Datos del pedido -->
    <div class="card">
      <h2>Datos del Pedido</h2>

      <label>Cliente:</label>
      <input id="cliente" placeholder="Nombre del cliente" />

      <label>Fecha Pedido:</label>
      <input id="fecha-pedido" type="date" />

      <label>Transporte:</label>
      <input id="transporte" placeholder="Transporte" />

      <label>Condiciones:</label>
      <input id="condiciones" placeholder="Condiciones" />

      <label>Vendedor:</label>
      <input id="vendedor" placeholder="Vendedor" />

      <label>Fecha Entrega:</label>
      <input id="fecha-entrega" type="date" />

      <label>Observaciones:</label>
      <textarea id="observaciones" placeholder="Observaciones..."></textarea>

      <div class="btns">
        <button id="guardar-local" class="btn-warning">Guardar Pedido</button>
        <button id="btn-historial" class="btn-primary">Ver historial</button>
        <button id="recargar" class="btn-danger">Recargar</button>
      </div>
    </div>

    <!-- Aquí el JS arma las tablas/listas de productos -->
    <div class="card">
      <h2>Productos</h2>
      <div id="formulario-productos"></div>
    </div>
  </div>

  <footer>
    © Ricotona — <button id="footer-historial">Ver historial</button>
  </footer>

  <!-- Tu lógica de productos / guardado -->
  <script src="script.js"></script>

  <!-- Helpers compartidos + navegación interna -->
  <script>
    // ====== clave única y helpers de almacenamiento (compartidos) ======
    window.STORAGE_KEY = 'ricotona_pedidos_v1';
    window.RicoStore = {
      get() {
        try { return JSON.parse(localStorage.getItem(window.STORAGE_KEY) || '[]'); }
        catch { return []; }
      },
      set(arr) {
        localStorage.setItem(window.STORAGE_KEY, JSON.stringify(arr));
      }
    };

    // ====== navegación interna (misma WebView) ======
    function gotoHistorial() {
      window.location.href = 'historial.html';
    }
    document.getElementById('btn-historial')?.addEventListener('click', gotoHistorial);
    document.getElementById('footer-historial')?.addEventListener('click', gotoHistorial);
    document.getElementById('recargar')?.addEventListener('click', () => location.reload());

    // ====== puente de compatibilidad: si script.js usa otra clave, copiamos ======
    document.getElementById('guardar-local')?.addEventListener('click', () => {
      // Le damos tiempo a script.js para guardar donde lo hace hoy
      setTimeout(() => {
        const candidates = [
          'ricotona_pedidos_v1',
          'pedidosRicotona',
          'pedidos',
          'pedidos-ricotona',
          'RicotonaPedidos'
        ];
        for (const k of candidates) {
          try {
            const arr = JSON.parse(localStorage.getItem(k) || '[]');
            if (Array.isArray(arr) && arr.length) {
              localStorage.setItem('ricotona_pedidos_v1', JSON.stringify(arr));
              break;
            }
          } catch (e) {}
        }
        // Ir al historial dentro de la misma WebView
        gotoHistorial();
      }, 250);
    });
  </script>
</body>
</html>
